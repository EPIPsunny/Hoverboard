3、用单片机来控制
正是舵机的控制信号是一个脉宽调制信号，所以很方便和数字系统进行接口。只要能产生标准的控制信号的数字设备都可以用来控制舵机，比方PLC、单片机等。这里介绍利用51系列单片机产生舵机的控制信号来进行控制的方法，编程语言为C51。之所以介绍这种方法只是因为笔者用2051实现过，本着负责的态度，所以敢在这里写出来。程序用的是我的四足步行机器人，有删改。单片机并不是控制舵机的最好的方法，希望在此能起到抛砖引玉的作用。
2051有两个16位的内部计数器，我们就用它来产生周期20 ms的脉冲信号，根据需要，改变输出脉宽。基本思路如下（请对照下面的程序）：
我用的晶振频率为12M，2051一个时钟周期为12个晶振周期，正好是1/1000 ms，计数器每隔1/1000 ms计一次数。以计数器1为例，先设定脉宽的初始值，程序中初始为1.5ms，在for循环中可以随时通过改变a值来改变，然后设定计数器计数初始值为a，并置输出p12为高位。当计数结束时，触发计数器溢出中断函数，就是void timer0(void) interrupt 1 using1 ，在子函数中，改变输出p12为反相（此时跳为低位），在用20000（代表20ms周期）减去高位用的时间a，就是本周期中低位的时间，c=20000-a，并设定此时的计数器初值为c，直到定时器再次产生溢出中断，重复上一过程。

# include <reg51.h>
#define uchar unsigned char
#define uint unsigned int

uint a,b,c,d;
/*a为舵机1的脉冲宽度，b为舵机2的脉冲宽度，单位1/1000 ms */
/*c、d为中间变量*/

/*以下定义输出管脚*/
sbit p12=P1^2;
sbit p13=p1^3;
sbit p37=P3^7;

/*以下两个函数为定时器中断函数*/

/*定时器1，控制舵机1，输出引脚为P12，可自定义*/
void timer0(void) interrupt 1 using 1
{p12=!p12; /*输出取反*/
c=20000-c; /*20000代表20 ms，为一个周期的时间*/
TH0=-(c/256); TL0=-(c%256); /*重新定义计数初值*/
if(c>=500&&c<=2500)c=a;
else c="20000-a"; /*判断脉宽是否在正常范围之内*/
}

/*定时器2，控制舵机2，输出引脚为P13，可自定义*/
void timer1(void) interrupt 3 using 1
{p13=!p13;
d=20000-d;
TH1=-(d/256); TL1=-(d%256);
if(d>=500&&d<=2500)d=b;
else d="20000-b";
}

/*主程序*/
void main(void)
{TMOD=0x11; /*设初值*/
p12=1;
p13=1;
a=1500;
b=1500; /*数值1500即对应1.5ms，为舵机的中间90度的位置*/
c=a;d=b;
TH0=-(a/256); TL0=-(a%256);
TH1=-(b/256); TL1=-(b%256); /*设定定时器初始计数值*/
EA=1;
ET0=1; TR0=1;EX0=1;EX1=1;
ET1=1; TR1=1;
PX0=0;PX1=0;PT1=1;PT0=1;/*设定中断优先级*/
for(;;)
{
/*在这个for循环中，可以根据程序需要
在任何时间改变a、b值来改变脉宽的输
出时间，从而控制舵机*/
}
}

因为在脉冲信号的输出是靠定时器的溢出中断函数来处理，时间很短，因此在精度要求不高的场合可以忽略。因此如果忽略中断时间，从另一个角度来讲就是主程序和脉冲输出是并行的，因此，只需要在主程序中按你的要求改变a值，例如让a从500变化到2500，就可以让舵机从0度变化到180度。另外要记住一点，舵机的转动需要时间的，因此，程序中a值的变化不能太快，不然舵机跟不上程序。根据需要，选择合适的延时，用一个a递增循环，可以让舵机很流畅的转动，而不会产生像步进电机一样的脉动。这些还需要实践中具体体会。


舵机的速度决定于你给它的信号脉宽的变化速度。举个例子，t＝0试，脉宽为0.5ms，t＝1s时，脉宽为1.0ms，那么，舵机就会从0.5ms对应的位置转到1.0ms对应的位置，那么转动速度如何呢？一般来讲，3003的最大转动速度在4.8V时为0.23s/60度，也就是说，如果你要求的速度比这个快的话，舵机就反应不过来了；如果要求速度比这个慢，可以将脉宽变化值线性到你要求的时间内，做一个循环，一点一点的增加脉宽值，就可以控制舵机的速度了。当然，具体这一点一点到底是多少，就需要做试验了，不然的话，不合适的话，舵机就会向步进电机一样一跳一跳的转动了，尝试改变这“一点”，使你的舵机运动更平滑。还有一点很重要，就是舵机在每一次脉宽值改变的时候总会有一个转速由零增加再减速为零的过程，这就是舵机会产生像步进电机一样运动的原因